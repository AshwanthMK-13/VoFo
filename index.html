<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VoFo Music</title>
<style>
body { font-family: Arial; padding: 20px; }
input { width: 70%; padding: 8px; }
button { padding: 8px 12px; margin-left: 5px; }
.song { cursor: pointer; margin: 10px 0; padding: 5px; border-radius: 5px; }
.song:hover { background: #f0f0f0; }
audio { width: 100%; margin-top: 20px; }
.thumbnail { width: 50px; vertical-align: middle; margin-right: 10px; }
</style>
</head>
<body>

<h2>VoFo Music</h2>
<input id="searchInput" placeholder="Search for songs">
<button onclick="searchSongs()">Search</button>

<div id="results"></div>

<audio id="audioPlayer" controls playsinline></audio>

<script>
async function searchSongs() {
    const query = document.getElementById("searchInput").value;
    if (!query) return;

    const res = await fetch(`/api/search?q=${encodeURIComponent(query)}`);
    const data = await res.json();

    const resultsDiv = document.getElementById("results");
    resultsDiv.innerHTML = "";

    data.forEach(song => {
        const div = document.createElement("div");
        div.className = "song";

        div.innerHTML = `
            <img src="${song.thumbnail}" class="thumbnail">
            ${song.title} - ${song.composer}
        `;
        div.dataset.videoId = song.id;
        div.addEventListener("click", () => playSong(song.id));
        resultsDiv.appendChild(div);
    });
}

async function playSong(videoId) {
    try {
        const res = await fetch("/api/play", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ video_id: videoId })
        });
        const data = await res.json();

        const audio = document.getElementById("audioPlayer");
        audio.src = data.url;   // Direct audio URL from YouTube
        await audio.play();
    } catch (err) {
        console.log("Playback error:", err);
        alert("Tap anywhere to enable audio playback!");
    }
}
</script>

</body>

</html>
